# DeFi - 去中心化金融 (Decentralized Finance)

## 一句话大白话

**DeFi 就是没有银行的银行服务——用代码代替银行员工，用智能合约代替银行金库。**

想象一下：你想借钱，不用填表、不用信用评估、不用等审批。你把抵押物锁进一个透明的保险箱（智能合约），系统自动给你放款。到期不还？保险箱自动把抵押物卖掉还债。全程没有一个人类参与。

---

## 它解决什么问题

### 传统金融的问题

| 问题 | 说明 |
|------|------|
| 门槛高 | 开户要证件、信用评估、最低金额 |
| 效率低 | 跨境转账要几天，借贷审批要几周 |
| 不透明 | 你不知道银行拿你的钱干嘛 |
| 有中间人 | 银行赚利差，你拿利息少、付利息多 |
| 有地域限制 | 很多服务你所在地区不可用 |
| 可能被拒绝 | 银行可以拒绝给你服务 |

### DeFi 的解决方案

| DeFi 特点 | 说明 |
|-----------|------|
| 无门槛 | 有钱包就能用，不问你是谁 |
| 24/7 运行 | 代码不休息 |
| 完全透明 | 所有代码和交易链上可查 |
| 无中间人 | 点对点或点对协议 |
| 全球可用 | 只要能上网就能用 |
| 无需许可 | 没人能阻止你使用 |

---

## 什么时候用 / 什么时候别用

### 适合用 DeFi 的场景

| 场景 | 说明 |
|------|------|
| 赚取存款收益 | 收益通常高于银行（但风险也高） |
| 杠杆交易 | 无需 KYC 的杠杆 |
| 资产兑换 | 24/7 可交易任意代币 |
| 跨境支付 | 分钟级到账，低手续费 |

### 不适合用 DeFi 的场景

| 场景 | 说明 |
|------|------|
| 不懂操作的新手 | 操作失误无法撤销，钱丢了没人赔 |
| 用全部身家 | 智能合约风险、黑客风险真实存在 |
| 追求本金安全 | DeFi 没有存款保险 |
| 不愿意学习 | DeFi 变化快，需要持续学习 |

### 判断口诀
> 小资金试水学习，分散投入控制风险，看不懂的不碰

---

## 它不是什么

### 常见误解

| 误解 | 事实 |
|------|------|
| DeFi 是稳赚的 | 高收益 = 高风险，很多人亏钱 |
| DeFi 完全去中心化 | 很多协议有管理员密钥、治理代币集中 |
| DeFi 不会被黑 | 每年数十亿美元被盗 |
| APY 高就是好项目 | 超高 APY 往往是庞氏骗局 |
| DeFi 匿名安全 | 链上可追踪，黑客也有被抓的 |

---

## 最小例子

### DeFi 核心组件概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                        DeFi 乐高积木                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│
│  │   稳定币    │  │    DEX     │  │   借贷      │  │   衍生品   ││
│  │  Stablecoin │  │ 去中心化   │  │  Lending   │  │ Derivatives ││
│  │            │  │   交易所   │  │            │  │            ││
│  │ USDT,USDC │  │ Uniswap   │  │ Aave,      │  │ GMX,       ││
│  │ DAI       │  │ Curve     │  │ Compound   │  │ dYdX       ││
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘│
│         │                │               │                │        │
│         └────────────────┼───────────────┼────────────────┘        │
│                          │               │                         │
│                    ┌─────┴───────────────┴─────┐                   │
│                    │        可组合性            │                   │
│                    │   DeFi 乐高积木可以        │                   │
│                    │   自由组合成新产品         │                   │
│                    └───────────────────────────┘                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1. DEX (去中心化交易所) - AMM 原理

```
传统交易所 (订单簿):
┌────────────────────────────────────────┐
│  卖单          │         买单          │
│  1 ETH @ $2400 │  1 ETH @ $2390       │
│  2 ETH @ $2405 │  3 ETH @ $2385       │
│  ...           │  ...                 │
│                                        │
│  买卖双方挂单，价格匹配才成交           │
└────────────────────────────────────────┘

DEX (自动做市商 AMM):
┌────────────────────────────────────────┐
│           流动性池                      │
│  ┌──────────────────────────────┐      │
│  │  ETH: 100 个                 │      │
│  │  USDC: 240,000 个            │      │
│  │                              │      │
│  │  恒定乘积公式:               │      │
│  │  ETH × USDC = K (常数)       │      │
│  │  100 × 240,000 = 24,000,000 │      │
│  └──────────────────────────────┘      │
│                                        │
│  你想用 USDC 买 ETH:                   │
│  1. 往池子里加 USDC                    │
│  2. 池子按公式吐出 ETH 给你            │
│  3. 买的越多，价格越高（滑点）         │
└────────────────────────────────────────┘

价格计算示例:
当前: 100 ETH, 240,000 USDC
价格 = 240,000 / 100 = $2,400/ETH

你想买 1 ETH:
新状态: 99 ETH, ? USDC
99 × ? = 24,000,000
? = 242,424 USDC

你需要付: 242,424 - 240,000 = 2,424 USDC
实际价格: $2,424/ETH (比 $2,400 贵，这就是滑点)
```

### 2. 借贷协议原理

```
传统银行借贷:
┌────────────────────────────────────────┐
│ 你 → 申请 → 银行审批 → 放款            │
│                                        │
│ 需要: 信用评估、收入证明、抵押物估值... │
│ 时间: 几天到几周                        │
└────────────────────────────────────────┘

DeFi 借贷 (如 Aave, Compound):
┌────────────────────────────────────────┐
│                                        │
│  存款池                借款池          │
│  ┌─────────┐          ┌─────────┐     │
│  │ USDC    │          │ USDC    │     │
│  │ 存款者  │ ←利息─── │ 借款者  │     │
│  │ 赚利息  │          │ 付利息  │     │
│  └─────────┘          └─────────┘     │
│       ↑                    │          │
│       │                    ▼          │
│       │            ┌─────────────┐    │
│       └────────────│  超额抵押   │    │
│                    │  借 80 USDC │    │
│                    │  押 100$ ETH│    │
│                    └─────────────┘    │
│                                        │
└────────────────────────────────────────┘

超额抵押示例:
1. 你有 1 ETH (价值 $2400)
2. 存入协议作为抵押物
3. 最大借款: $2400 × 75% = $1800 USDC
4. 如果 ETH 跌到 $2000，抵押率下降
5. 跌破清算线 → 自动清算卖掉你的 ETH

利率是动态的:
- 池子里钱多 → 借的人少 → 利率低
- 池子里钱少 → 借的人多 → 利率高
```

### 3. 稳定币原理

```
三种稳定币类型:

1. 法币抵押型 (USDT, USDC)
┌────────────────────────────────────────┐
│ 中心化公司                              │
│ ┌──────────────────────────────────┐   │
│ │ 银行账户: 10 亿美元               │   │
│ │ 链上发行: 10 亿 USDC             │   │
│ │                                  │   │
│ │ 1 USDC = 1 USD 承诺              │   │
│ └──────────────────────────────────┘   │
│ 风险: 要信任发行方真的有那么多钱        │
└────────────────────────────────────────┘

2. 加密资产抵押型 (DAI)
┌────────────────────────────────────────┐
│ 智能合约 (MakerDAO)                    │
│ ┌──────────────────────────────────┐   │
│ │ 用户存入 $150 的 ETH             │   │
│ │ 铸造 100 DAI                     │   │
│ │ 超额抵押保证 1 DAI ≈ 1 USD       │   │
│ └──────────────────────────────────┘   │
│ 风险: 抵押物暴跌可能导致脱锚           │
└────────────────────────────────────────┘

3. 算法稳定币 (已大多失败)
┌────────────────────────────────────────┐
│ 纯靠算法和套利维持锚定                  │
│ 没有实际抵押物                          │
│                                        │
│ 例: UST/LUNA - 2022 年崩盘              │
│ 损失超过 400 亿美元                     │
└────────────────────────────────────────┘
```

### 4. 流动性挖矿 (Yield Farming)

```
基本原理:
┌────────────────────────────────────────┐
│                                        │
│ 你提供流动性 (比如 ETH + USDC)         │
│         │                              │
│         ▼                              │
│ ┌──────────────────────────────────┐   │
│ │ 流动性池                          │   │
│ │                                  │   │
│ │ 收益来源:                        │   │
│ │ 1. 交易手续费分成 (0.3%)         │   │
│ │ 2. 协议奖励代币                  │   │
│ │ 3. 可能还有额外激励              │   │
│ └──────────────────────────────────┘   │
│         │                              │
│         ▼                              │
│ 你获得: 手续费 + 代币奖励              │
│                                        │
│ 风险: 无常损失 (Impermanent Loss)      │
└────────────────────────────────────────┘

无常损失简单解释:
- 你存入 1 ETH + 2400 USDC
- ETH 涨到 $3000
- 因为 AMM 机制，池子会自动再平衡
- 你取出时可能只有 0.89 ETH + 2680 USDC
- 总价值 $5350，但如果你直接持有是 $5400
- 损失了 $50，这就是无常损失
```

---

## 新手最常踩的 3 个坑

### 1. 被高 APY 吸引

**坑**：看到 1000% APY 就冲进去。

**现实**：
- 高 APY 通常来自代币通胀（代币在疯狂贬值）
- 或者是新项目吸引流动性的短期激励
- 本金缩水速度可能超过收益

**正解**：
- APY > 100% 要高度警惕
- 了解收益的来源
- 关注代币价格变化，不只看 APY

### 2. 不理解「授权」的风险

**坑**：随便连钱包，随便签名授权。

**后果**：
```
假冒 DeFi 网站请求授权
→ 你授权了「无限额度」
→ 网站是钓鱼网站
→ 你所有代币被转走
```

**正解**：
- 只访问官方链接
- 仔细看授权内容
- 使用小钱包交互
- 定期清理授权

### 3. 忽视智能合约风险

**坑**：以为「去中心化」就是安全的。

**现实**：
| 年份 | 事件 | 损失 |
|------|------|------|
| 2020 | bZx 闪电贷攻击 | $35M |
| 2021 | Poly Network 被黑 | $611M |
| 2022 | Wormhole 被黑 | $320M |
| 2022 | Ronin 被黑 | $620M |

**正解**：
- 分散资金，不要 all-in 一个协议
- 优先选择经过时间检验的老协议
- 关注项目的审计报告
- 设置价格预警

---

## 流程图定位

```
┌──────┐    ┌──────────┐    ┌────────┐    ┌──────────┐    ┌────────────┐
│ 用户 │───▶│ 创建钱包 │───▶│ 连接   │───▶│ 与合约   │───▶│ 状态更新   │
│ 意图 │    │ (私钥)   │    │ DApp   │    │ 交互     │    │ (余额等)   │
└──────┘    └──────────┘    └────────┘    └──────────┘    └────────────┘

DeFi 是智能合约的具体应用:
1. 用户连接钱包到 DeFi 前端
2. 前端帮你构造交易（调用合约函数）
3. 你签名确认
4. 合约执行，状态更新

一笔 Uniswap 兑换的完整流程:
用户想换币 → 连接 Uniswap → 选择交易对和数量
→ 授权代币（如果是首次） → 确认兑换
→ 签名交易 → 合约执行 → 代币余额变化
```

---

## 自测题

1. **为什么 DeFi 借贷需要「超额抵押」？100% 抵押不行吗？**

   <details>
   <summary>点击查看答案</summary>
   因为：
   1. 没有信用评估，协议不知道你会不会还
   2. 抵押物价格会波动，可能跌破借款金额
   3. 清算需要时间，需要缓冲空间

   超额抵押确保即使抵押物暴跌，协议也有足够的资产来偿还存款人。这是 DeFi 实现「无信任借贷」的代价。
   </details>

2. **AMM 的「滑点」是怎么产生的？怎么减少滑点？**

   <details>
   <summary>点击查看答案</summary>
   滑点产生原因：
   AMM 按照恒定乘积公式运作，买入越多，价格上涨越快（因为池子里该代币越来越少）。

   减少滑点的方法：
   1. 选择流动性更深的池子
   2. 减少单笔交易金额
   3. 拆分成多笔小交易
   4. 使用聚合器（如 1inch）寻找最优路径
   5. 选择流动性集中的协议（如 Uniswap V3）
   </details>

3. **「无常损失」为什么叫「无常」？什么情况下损失会变成「永久」？**

   <details>
   <summary>点击查看答案</summary>
   叫「无常」是因为：
   - 如果价格回到你存入时的水平，损失就消失了
   - 损失只有在你取出流动性时才「实现」

   变成「永久」损失的情况：
   - 你在价格偏离时取出流动性
   - 价格永远没回到原来的水平

   本质上，提供流动性 = 做空波动率。价格剧烈波动对 LP 不利。
   </details>
