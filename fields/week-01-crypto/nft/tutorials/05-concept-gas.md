# Gas 费 (Gas Fee)

## 一句话大白话

**Gas 费就是区块链上的"手续费"——你付钱让矿工帮你处理交易，就像寄快递要付邮费。**

在以太坊上，每个操作（转账、铸造 NFT、交易）都要消耗"Gas"，你要用 ETH 支付这个费用。

---

## 它解决什么问题

### 核心痛点：谁来处理你的交易？

区块链没有中心服务器，那谁来记录你的交易？

答案是：矿工（验证者）。他们用自己的电脑/服务器帮你处理交易，自然要收费。

### Gas 的双重作用

1. **激励矿工**：付费让矿工愿意处理你的交易
2. **防止滥用**：如果操作免费，会有人无限循环堵塞网络

```
没有 Gas 费的世界：
恶意用户写一个死循环合约
→ 全网节点都在执行这个死循环
→ 网络瘫痪

有 Gas 费的世界：
每执行一步都要付钱
→ 死循环会花光攻击者的钱
→ 自动停止，网络安全
```

---

## 什么时候用 / 什么时候别用

### ✅ 必须支付 Gas 的操作

任何改变区块链状态的操作都要付 Gas：
- 铸造 NFT（mint）
- 转移 NFT（transfer）
- 买卖 NFT
- 授权合约（approve）
- 取消上架（delist）

### ❌ 不需要 Gas 的操作

只读取数据、不改变链上状态的操作不需要 Gas：
- 查看钱包余额
- 浏览 NFT 详情
- 查看交易历史
- 连接钱包（只是签名，不上链）

---

## 它不是什么（常见混淆点）

### ❌ Gas ≠ 固定手续费

Gas 费是动态变化的：
- 网络拥堵时，Gas 费飙升
- 网络空闲时，Gas 费便宜
- 复杂操作比简单操作贵

### ❌ Gas ≠ 交易失败能退

**即使交易失败，Gas 也不退！**

矿工已经花了计算资源来尝试执行你的交易，即使最终失败，他们的工作量已经付出了。

### ❌ Gas 单位 ≠ Gas 费用

Gas 费用计算公式：
```
Gas 费用（ETH）= Gas 数量 × Gas 价格

例如：
- Gas 数量：21,000（简单转账的标准值）
- Gas 价格：30 Gwei（网络当前价格）
- Gas 费用 = 21,000 × 30 Gwei = 630,000 Gwei = 0.00063 ETH
```

---

## 最小例子

### 不同操作的 Gas 消耗

| 操作 | 大约 Gas 消耗 | 费用估算（假设 30 Gwei）|
|------|-------------|---------------------|
| ETH 转账 | 21,000 | ~$1-2 |
| ERC-20 转账 | 65,000 | ~$3-5 |
| NFT 铸造 | 100,000-300,000 | ~$5-30 |
| NFT 转账 | 50,000-100,000 | ~$3-10 |
| 复杂合约交互 | 200,000+ | ~$10-50+ |

### Gas 价格单位

```
1 ETH = 1,000,000,000 Gwei = 1,000,000,000,000,000,000 Wei

常见单位：
- Wei：最小单位
- Gwei：Gas 价格常用单位（1 Gwei = 10^9 Wei）
- ETH：最终支付时用的单位
```

### 实时查看 Gas 价格

推荐网站：
- https://etherscan.io/gastracker
- https://ethgasstation.info

```
Gas 价格等级：
🐢 Slow (慢): 15 Gwei - 几分钟到十几分钟
🚗 Average (中): 25 Gwei - 1-3 分钟
🚀 Fast (快): 35 Gwei - 几十秒

注：实际价格随网络波动
```

---

## 新手最常踩的 3 个坑

### 1. 高峰期操作被"天价 Gas"吓到

**坑**：热门 NFT 发售时铸造，Gas 比 NFT 还贵

**真相**：
- 热门项目发售时全网抢铸造
- 网络极度拥堵，Gas 价格飙升到平时的 10-100 倍
- 花 $500 Gas 铸造 $50 的 NFT

**正确做法**：
- 不急的操作等低峰期（美国深夜/周末）
- 用 Gas 追踪工具设置提醒
- 提前准备足够的 ETH

### 2. 交易失败还扣了 Gas

**坑**：铸造失败，ETH 没了，NFT 也没有

**原因**：
- NFT 售罄了但你不知道
- Gas Limit 设太低
- 合约条件没满足（不在白名单等）

**正确做法**：
- 操作前确认条件（还有库存吗？在白名单吗？）
- 不要手动调低 Gas Limit
- 用模拟工具预测交易是否会成功

### 3. Gas Limit 和 Gas Price 傻傻分不清

**坑**：想省钱调低了 Gas Limit，结果交易失败

**解释**：
```
Gas Limit：你愿意为这笔交易最多用多少 Gas
Gas Price：每单位 Gas 你愿意付多少钱

类比：
Gas Limit = 你给出租车司机准备的最多车费
Gas Price = 每公里多少钱

如果路程需要 100 公里，你只准备了 50 公里的钱（Gas Limit 太低）
→ 车开到半路钱花完了
→ 你被撇在路中间（交易失败）
→ 已经开的路程的钱不退（Gas 不退）
```

**正确做法**：
- Gas Limit：让钱包自动估算，别手动调低
- Gas Price：可以调低来省钱，但会变慢

---

## 流程图定位

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  准备阶段  │───▶│  创作阶段  │───▶│  铸造阶段  │───▶│  交易阶段  │───▶│  持有阶段  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘    └──────────┘
     │                               │               │
     ▼                               ▼               ▼
 【获取 ETH】                   【支付 Gas】     【支付 Gas】
 准备 Gas 费用                  铸造需要 Gas    交易需要 Gas
```

Gas 在每个链上操作环节都会出现：
- **准备阶段**：确保钱包里有足够的 ETH 付 Gas
- **铸造阶段**：mint 操作需要付 Gas
- **交易阶段**：买卖、转账都需要付 Gas

---

## 省 Gas 技巧

### 1. 选择低峰时段

```
以太坊网络活跃时间（UTC）：
- 高峰：周一到周五 14:00-20:00（美国工作时间）
- 低峰：周末、美国深夜

中国时间低峰参考：
- 周末全天
- 工作日早上 6:00-10:00
```

### 2. 使用 Layer 2

| 链 | Gas 费用 | 速度 | 生态 |
|----|---------|------|------|
| 以太坊主网 | 高 | 慢 | 最完善 |
| Polygon | 极低 | 快 | 较完善 |
| Arbitrum | 低 | 快 | 发展中 |
| Optimism | 低 | 快 | 发展中 |

### 3. 批量操作

有些操作可以批量完成，平摊 Gas：
- 批量铸造
- 批量转账

---

## 自测题

1. **概念理解**：为什么交易失败了 Gas 费也不退？

2. **计算题**：一笔 NFT 铸造消耗 150,000 Gas，当前 Gas Price 是 40 Gwei，这笔交易的 Gas 费是多少 ETH？（假设 1 ETH = $2000，折合多少美元？）

3. **实操判断**：以下哪种做法可以省 Gas？
   - A. 把 Gas Limit 调到最低
   - B. 在周末凌晨操作
   - C. 选择使用 Polygon 而不是以太坊主网
   - D. 等待 Gas Price 下降后再操作

<details>
<summary>参考答案</summary>

1. 因为矿工已经付出了计算资源来尝试执行你的交易。即使交易最终因为某些条件不满足而失败，矿工验证和尝试执行的工作已经完成了。Gas 是付给矿工的"劳务费"，不是"成功费"。

2. 计算过程：
   - Gas 费用 = 150,000 × 40 Gwei = 6,000,000 Gwei
   - 6,000,000 Gwei = 0.006 ETH
   - 0.006 ETH × $2000 = $12

   答案：0.006 ETH，约 $12

3. 答案是 B、C、D 都可以省 Gas。
   - A 是错误的，Gas Limit 调太低会导致交易失败，Gas 照样扣
   - B 正确，低峰期 Gas Price 更低
   - C 正确，Layer 2 的 Gas 费用远低于主网
   - D 正确，Gas Price 是动态的，等低价时操作更省钱

</details>
