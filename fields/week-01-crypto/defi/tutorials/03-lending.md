# 借贷协议（Lending Protocol）

## 一句话大白话

**DeFi 借贷就是区块链上的「典当行」——你把贵重物品（加密资产）押进去，借出现金（稳定币或其他币），按时还钱拿回抵押品，还不上就被没收。**

---

## 它解决什么问题

### 传统借贷的痛点

```
银行贷款流程：

┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  提交申请 → 身份审核 → 信用评估 → 收入证明 → 审批等待       │
│     ↓         ↓         ↓          ↓          ↓            │
│   1天       3天       5天        7天       7-30天           │
│                                                             │
│  最终结果：可能被拒绝                                        │
│  如果通过：利率由银行说了算                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### DeFi 借贷的解决方案

```
DeFi 借贷流程：

┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  连接钱包 → 存入抵押品 → 设置借款金额 → 确认交易 → 到账     │
│     ↓          ↓            ↓            ↓          ↓      │
│   10秒       30秒         10秒         30秒       即时      │
│                                                             │
│  无需身份验证，无需信用评估                                  │
│  利率由市场供需自动决定                                      │
│  7×24 小时，全球开放                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 核心机制：超额抵押

### 为什么需要超额抵押？

```
传统银行：认识你 → 知道你的信用 → 可以无抵押借款
DeFi：    不认识你 → 不知道你会不会跑路 → 必须超额抵押

超额抵押 = 你要借 $100，必须押 $150+
```

### 抵押率与借款能力

```
┌─────────────────────────────────────────────────────────────┐
│                     抵押率计算                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   抵押率（LTV）= 借款金额 / 抵押品价值 × 100%               │
│                                                             │
│   例子：                                                    │
│   抵押 $1000 ETH，借出 $500 USDC                            │
│   LTV = 500 / 1000 = 50%                                    │
│                                                             │
│   ┌────────────────────────────────────────────┐            │
│   │ 安全区间      │ 警戒区间      │ 清算区间   │            │
│   │   0-60%      │  60-75%      │   >75%    │            │
│   │    绿        │    黄         │    红      │            │
│   └────────────────────────────────────────────┘            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 清算机制

```
什么时候会被清算？

┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  Day 1：你抵押 $1000 ETH，借 $500 USDC                      │
│         LTV = 50%，很安全 ✅                                 │
│                                                             │
│  Day 3：ETH 价格下跌 20%                                    │
│         抵押品价值 = $800                                   │
│         LTV = 500/800 = 62.5%，开始危险 ⚠️                  │
│                                                             │
│  Day 5：ETH 继续下跌                                        │
│         抵押品价值 = $650                                   │
│         LTV = 500/650 = 77%，触发清算！🚨                   │
│                                                             │
│  清算过程：                                                  │
│  1. 清算人（liquidator）偿还你的部分债务                    │
│  2. 清算人以折扣价（通常 5-10%）获得你的抵押品               │
│  3. 你损失了一部分抵押品 + 清算罚金                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 清算示例计算

```
初始状态：
抵押：10 ETH（$2000/个）= $20,000
借款：$10,000 USDC
LTV：50%
清算线：75%

ETH 跌到 $1350：
抵押品价值 = 10 × $1350 = $13,500
LTV = 10,000 / 13,500 = 74%
还没清算，但很危险！

ETH 跌到 $1300：
抵押品价值 = 10 × $1300 = $13,000
LTV = 10,000 / 13,000 = 77%
触发清算！🚨

清算结果（假设清算 50% 债务）：
- 清算人偿还 $5,000 债务
- 清算人获得 $5,000 / $1,300 × 1.05 = 4.04 ETH
- 你损失 4.04 ETH（包含 5% 清算罚金）
- 你还剩 5.96 ETH 抵押品，$5,000 债务
```

---

## 存款赚利息

### 利息从哪里来？

```
               存款人（赚利息）
                    │
                    │ 存入资产
                    ▼
            ┌─────────────────┐
            │    资金池       │
            │   (Aave/Compound) │
            └────────┬────────┘
                     │
                     │ 借出资产
                     ▼
               借款人（付利息）

存款利率 ≈ 借款利率 × 资金利用率

例：
- 借款利率：10%
- 资金利用率：80%（池子里 80% 的钱被借走）
- 存款利率 ≈ 10% × 80% = 8%
```

### 利率是如何动态调整的？

```
利率
│
│                           ╭─── 借款利率
│                      ╭────╯
│                 ╭────╯
│            ╭────╯
│       ╭────╯
│  ╭────╯
│──╯─────────────────── 存款利率
└────────────────────────────────▶ 资金利用率
0%                              100%

资金利用率低 → 利率低（鼓励借款）
资金利用率高 → 利率高（鼓励存款）

这是市场供需自动调节的结果！
```

---

## 什么时候用 / 什么时候别用

### ✅ 适合使用 DeFi 借贷的场景

| 场景 | 原因 |
|------|------|
| 看好某币但需要现金周转 | 抵押持仓借稳定币，不用卖币 |
| 杠杆做多 | 借稳定币买更多 ETH |
| 收益放大 | 存款收息 + 借款去做其他 DeFi 策略 |
| 税务优化 | 某些国家借款不算卖出，不触发资本利得税 |
| 闲置资产生息 | 稳定币存款收益通常高于银行 |

### ❌ 不适合使用的场景

| 场景 | 原因 |
|------|------|
| 没有风险意识 | 清算是真的会发生的 |
| 抵押品波动太大 | 容易触发清算 |
| 借满上限 | 一点波动就清算 |
| 不懂利率机制 | 借款利率会突然飙升 |
| 抵押小币种 | 流动性差，清算时损失更大 |

---

## 它不是什么（常见混淆点）

### ❌ DeFi 借贷不是「借钱给别人」

```
误解：我存进去的钱会被某个特定的人借走

实际：
┌─────────────────────────────────────────┐
│  你的存款进入「资金池」                   │
│  借款人从「资金池」借钱                   │
│  你不知道谁借了你的钱                    │
│  你也不需要追讨，协议自动处理             │
└─────────────────────────────────────────┘
```

### ❌ 抵押品不是「被冻结」

```
误解：抵押的 ETH 就完全不能用了

实际（取决于协议）：
• 有些协议抵押品还能产生收益
• Aave 的 aToken 可以继续赚利息
• 但确实不能自由转移
```

### ❌ 清算不是「全部没收」

```
误解：一旦清算就所有抵押品都没了

实际：
• 通常只清算部分（让你回到安全区间）
• 你会损失清算罚金（5-10%）
• 剩余抵押品还是你的
• 但如果价格继续跌，可能继续被清算
```

---

## 最小例子：Aave 借贷计算

### 场景设定

```python
# 你有 5 ETH，当前价格 $2000/ETH
eth_amount = 5
eth_price = 2000
collateral_value = eth_amount * eth_price  # $10,000

# Aave ETH 参数
max_ltv = 0.80  # 最大可借 80%
liquidation_threshold = 0.825  # 清算阈值 82.5%

# 你可以借多少？
max_borrow = collateral_value * max_ltv  # $8,000

# 安全起见，借 50%
actual_borrow = collateral_value * 0.50  # $5,000
current_ltv = actual_borrow / collateral_value  # 50%

print(f"抵押品价值: ${collateral_value:,}")
print(f"最大可借: ${max_borrow:,}")
print(f"实际借款: ${actual_borrow:,}")
print(f"当前 LTV: {current_ltv:.0%}")
```

### 计算清算价格

```python
# 你借了 $5,000 USDC
debt = 5000
liquidation_threshold = 0.825

# 清算时：debt / collateral_value = liquidation_threshold
# 所以：collateral_value = debt / liquidation_threshold
liquidation_collateral = debt / liquidation_threshold  # $6,060.6

# 清算时 ETH 价格
eth_amount = 5
liquidation_price = liquidation_collateral / eth_amount  # $1,212.12

print(f"清算触发价格: ${liquidation_price:.2f}/ETH")
print(f"当前价格 ${eth_price}，距离清算还有 {(eth_price - liquidation_price)/eth_price:.0%} 下跌空间")
```

### 健康系数（Health Factor）

```python
# 健康系数 = (抵押品价值 × 清算阈值) / 债务
health_factor = (collateral_value * liquidation_threshold) / debt
# = (10000 × 0.825) / 5000 = 1.65

print(f"健康系数: {health_factor:.2f}")

# 解读：
# > 1.0：安全
# = 1.0：触发清算
# < 1.0：正在被清算

# 如果 ETH 跌到 $1500
new_eth_price = 1500
new_collateral = eth_amount * new_eth_price  # $7,500
new_health_factor = (new_collateral * liquidation_threshold) / debt
# = (7500 × 0.825) / 5000 = 1.24

print(f"ETH 跌到 ${new_eth_price} 时健康系数: {new_health_factor:.2f}")
```

---

## 新手最常踩的 3 个坑

### 坑 1：借满上限

```
场景：
你看到最大可借 80%，就借满了
ETH 只跌 5%，直接触发清算

正确做法：
┌─────────────────────────────────────────┐
│  保守建议：只借最大额度的 50-60%          │
│                                         │
│  LTV 50% → ETH 需跌 40%+ 才清算          │
│  LTV 60% → ETH 需跌 30%+ 才清算          │
│  LTV 75% → ETH 只需跌 10% 就清算         │
└─────────────────────────────────────────┘
```

### 坑 2：忽视利率变化

```
场景：
你看到借款利率 5%，觉得很划算
过了一周，利率飙升到 50%
你的利息支出暴增，但你没注意

原因：
• 利率是浮动的，随时变化
• 热门资产被大量借走时利率飙升
• 某些极端情况利率可以到几百%

正确做法：
• 设置利率提醒
• 使用固定利率产品（如有）
• 密切关注资金利用率
```

### 坑 3：用小币做抵押

```
场景：
你用某小币做抵押借出 USDC
小币暴跌 30%，触发清算
清算时因为小币流动性差
你的清算罚金高达 20%

正确做法：
• 优先用 ETH、BTC 等主流币做抵押
• 小币抵押要留更大安全边际
• 了解清算机制和罚金比例
```

---

## 主流借贷协议对比

| 协议 | 链 | 特点 | 适合场景 |
|------|-----|------|---------|
| Aave | 多链 | 最大最稳，功能全 | 主流借贷需求 |
| Compound | 以太坊 | 老牌协议，简洁 | 基础借贷 |
| MakerDAO | 以太坊 | 铸造 DAI 稳定币 | 借 DAI |
| Venus | BSC | 费用低 | 小资金玩家 |
| Benqi | Avalanche | Avalanche 原生 | Avalanche 用户 |

---

## 借贷的高级策略（了解即可）

### 循环借贷（加杠杆）

```
初始：10 ETH
  │
  ▼
存入 10 ETH → 借出 5,000 USDC
  │
  ▼
用 USDC 买 2.5 ETH → 存入
  │
  ▼
再借出 1,250 USDC → 买 0.625 ETH → 存入
  │
  ▼
...循环...

最终效果：相当于 15-20 ETH 的敞口
但风险也放大了！
```

### 利率套利

```
协议 A 存款利率：5%
协议 B 借款利率：3%

策略：
从 B 借款 → 存到 A
赚取 2% 利差

风险：
• 利率随时变化
• 跨协议风险叠加
• Gas 费可能吃掉利润
```

---

## 流程图定位

```
┌─────────────────────────────────────────────────────────────┐
│                       DeFi 生态                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   你的钱包                                                   │
│      │                                                      │
│      ├──────────────┬──────────────┐                        │
│      ▼              ▼              ▼                        │
│   ┌──────┐    ╔══════════╗    ┌──────┐                      │
│   │ DEX  │    ║ 借贷协议 ║    │ 收益 │                      │
│   │ 交易 │    ╠══════════╣    │ 聚合 │                      │
│   └──────┘    ║  你在这里 ║    └──────┘                      │
│               ║          ║                                  │
│               ║ • 存款   ║                                  │
│               ║ • 借款   ║                                  │
│               ║ • 清算   ║                                  │
│               ╚══════════╝                                  │
│                    │                                        │
│                    ▼                                        │
│              ┌──────────┐                                   │
│              │  预言机   │ ← 提供价格，判断是否清算          │
│              └──────────┘                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 自测题

### 基础理解
1. 为什么 DeFi 借贷需要超额抵押？传统银行信用贷不需要抵押的原理是什么？
2. 健康系数 1.5 意味着什么？什么时候触发清算？
3. 存款利率和借款利率为什么不一样？差价去哪了？

### 实践应用
4. 你有 $10,000 ETH，想借出 $4,000 USDC。ETH 跌到多少会触发清算？（假设清算阈值 82.5%）
5. 如果你发现某协议存款利率突然从 3% 飙到 30%，说明什么？

### 深度思考
6. 为什么说 DeFi 借贷是「典当行」而不是「银行」？
7. 清算人是怎么赚钱的？这个机制对整个系统有什么作用？

---

## 答案提示

1. DeFi 不知道你是谁，无法追讨债务，所以必须超额抵押；银行能通过征信系统追讨，所以可以信用贷
2. 健康系数 1.5 表示抵押品价值是清算线的 1.5 倍；健康系数 = 1 时触发清算
3. 差价是协议的「利差收入」，用于协议开发、安全储备等
4. 清算价格 = 4000 / 0.825 / (10000/ETH当前价格) = 约 $4848（假设当前 ETH $2000，那么跌到约 $970）
5. 说明大量资金被借走，资金利用率很高，可能有套利机会或有大户在做策略
6. 典当行只看抵押物不看人；银行要看人的信用
7. 清算人以折扣价买到抵押品，赚取清算折扣；这保证了协议的偿付能力，是系统安全的关键环节
