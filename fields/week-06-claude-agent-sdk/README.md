# Claude Agent SDK 学习框架

## 0. 环境准备（开始前必读）

### 前置要求
- **Python 基础**：了解变量、函数、字典、列表等基础语法
- **Python 版本**：3.9 或更高版本

### 安装步骤

**第一步：检查 Python 版本**
```bash
python --version
# 或
python3 --version
# 需要显示 Python 3.9.x 或更高
```

**第二步：安装 Anthropic SDK**
```bash
pip install anthropic
# 或使用 pip3
pip3 install anthropic
```

**第三步：获取 API Key**

1. 访问 [console.anthropic.com](https://console.anthropic.com)
2. 注册/登录账号
3. 点击左侧菜单 "API Keys"
4. 点击 "Create Key" 按钮
5. 复制生成的 Key（格式类似 `sk-ant-api03-xxx...`）

> **费用说明**：API 调用按 token 计费。新用户通常有免费额度，具体以官网为准。1000 tokens 约等于 750 个英文单词或 500 个中文字。

**第四步：设置环境变量**

Mac/Linux:
```bash
export ANTHROPIC_API_KEY="sk-ant-api03-你的密钥"
# 永久生效请添加到 ~/.bashrc 或 ~/.zshrc
```

Windows CMD:
```cmd
set ANTHROPIC_API_KEY=sk-ant-api03-你的密钥
```

Windows PowerShell:
```powershell
$env:ANTHROPIC_API_KEY="sk-ant-api03-你的密钥"
```

**第五步：验证安装**
```python
from anthropic import Anthropic
client = Anthropic()
print("安装成功！")
```

如果没有报错，恭喜你，环境准备完成！

---

## 1. 终极目标

### 解决的问题
**让 AI 不只是"回答问题"，而是能"自主完成任务"。**

传统的 LLM 调用是"一问一答"模式：你问一个问题，AI 回答一次，结束。但现实中的任务往往需要多个步骤：
- 查天气 → 需要调用天气 API
- 订机票 → 需要查询航班、比价、下单
- 写代码 → 需要读文件、写文件、运行测试

Claude Agent SDK 让 Claude 能够**调用工具、循环执行、自主决策**，从"对话助手"进化为"任务执行者"。

### 最终交付物
一个能**自主完成多步骤任务**的 AI Agent 应用，例如：
- 智能客服：自动查询订单、处理退款
- 代码助手：读取代码、分析问题、自动修复
- 数据分析师：获取数据、生成图表、写报告

### 评判标准
- 能用 Python 代码构建一个带工具调用的 Agent
- 理解 Agent 的核心循环：感知 → 决策 → 行动 → 反馈
- 能处理工具调用的结果并继续对话

---

## 2. 流程全景图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Claude Agent SDK 工作流程                              │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────┐
                              │   用户输入   │
                              │ "查北京天气" │
                              └──────┬──────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  阶段1：初始化                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  输入: API Key + 工具定义 + 用户消息                                   │    │
│  │  加工: 创建 Anthropic 客户端，注册工具                                  │    │
│  │  输出: 可用的 client 对象 + tools 列表                                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  阶段2：发送请求                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  输入: messages + tools + model                                       │    │
│  │  加工: client.messages.create() 调用 API                              │    │
│  │  输出: Claude 的响应（可能包含 tool_use）                               │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
                         ┌───────────────────────┐
                         │ 响应类型判断            │
                         │ stop_reason == ?      │
                         └───────────┬───────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    ▼                                 ▼
           ┌──────────────┐                  ┌──────────────┐
           │ "end_turn"   │                  │ "tool_use"   │
           │ 直接返回文本  │                  │ 需要调用工具  │
           └──────────────┘                  └──────┬───────┘
                    │                               │
                    ▼                               ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  阶段3：工具执行（如果需要）                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  输入: tool_name + tool_input（如 {"city": "北京"}）                   │    │
│  │  加工: 执行本地 Python 函数（如调用天气 API）                            │    │
│  │  输出: tool_result（如 "北京今天 25°C，晴"）                            │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  阶段4：结果回传                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  输入: 原消息 + assistant响应 + tool_result                            │    │
│  │  加工: 拼接成新的 messages，再次调用 API                                │    │
│  │  输出: Claude 基于工具结果生成最终回答                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
                              ┌─────────────┐
                              │   最终输出   │
                              │"北京今天25°C"│
                              └─────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                           Agent 循环（Agentic Loop）                          │
│                                                                             │
│    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐         │
│    │   感知   │ ──▶ │   决策   │ ──▶ │   行动   │ ──▶ │   反馈   │ ──┐     │
│    │ Perceive │     │  Decide  │     │   Act    │     │ Feedback │   │     │
│    └──────────┘     └──────────┘     └──────────┘     └──────────┘   │     │
│         ▲                                                            │     │
│         └────────────────────────────────────────────────────────────┘     │
│                          （循环直到任务完成）                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 核心概念列表

| 概念 | 一句话解释 | 详细教程 |
|------|-----------|----------|
| **Anthropic Client** | 连接 Claude API 的"遥控器" | [01-client.md](tutorials/01-client.md) |
| **Messages API** | 发送消息、接收回复的核心接口 | [02-messages-api.md](tutorials/02-messages-api.md) |
| **Tool（工具）** | 教给 Claude 的"技能"，让它能调用外部功能 | [03-tool.md](tutorials/03-tool.md) |
| **Tool Use（工具调用）** | Claude 决定使用哪个工具、传什么参数 | [04-tool-use.md](tutorials/04-tool-use.md) |
| **Tool Result（工具结果）** | 工具执行后的返回值，反馈给 Claude | [05-tool-result.md](tutorials/05-tool-result.md) |
| **Agentic Loop（Agent 循环）** | 感知→决策→行动→反馈的自动化循环 | [06-agentic-loop.md](tutorials/06-agentic-loop.md) |
| **Streaming（流式响应）** | 实时逐字输出，提升用户体验 | [07-streaming.md](tutorials/07-streaming.md) |
| **@beta_tool 装饰器** | 用 Python 函数快速定义工具的语法糖 | [08-beta-tool-decorator.md](tutorials/08-beta-tool-decorator.md) |
| **Tool Runner** | 自动执行工具调用的便捷助手 | [09-tool-runner.md](tutorials/09-tool-runner.md) |

---

## 4. 单点穿透案例

**用一个"天气查询 Agent"跑通整个流程**

从零开始，用不到 50 行代码构建一个能查天气的 AI Agent：

👉 [case-study-weather-agent.md](tutorials/case-study-weather-agent.md)

这个案例会带你：
1. 安装 SDK 并初始化客户端
2. 定义一个 `get_weather` 工具
3. 发送请求，处理工具调用
4. 返回结果给 Claude，获得最终回答
5. 封装成可复用的 Agent 循环

---

## 5. 学习路径建议

```
第0天：环境准备
├── 安装 Python 3.9+
├── pip install anthropic
├── 获取 API Key 并设置环境变量
└── 验证安装成功

第1天：理解基础
├── 阅读 01-client.md（10分钟）
├── 阅读 02-messages-api.md（15分钟）
└── 动手：写一个最简单的 Claude 对话

第2天：掌握工具
├── 阅读 03-tool.md（15分钟）
├── 阅读 04-tool-use.md（15分钟）
├── 阅读 05-tool-result.md（10分钟）
└── 动手：定义并调用一个简单工具

第3天：构建 Agent
├── 阅读 06-agentic-loop.md（20分钟）
├── 完成 case-study-weather-agent.md（30分钟）
└── 动手：扩展 Agent，添加更多工具

第4天：进阶提升（可选）
├── 阅读 07-streaming.md（15分钟）
├── 阅读 08-beta-tool-decorator.md（15分钟）
├── 阅读 09-tool-runner.md（15分钟）
└── 动手：用 Tool Runner 重构你的 Agent
```

> **提示**：第4天的内容涉及异步编程和装饰器等 Python 进阶概念，初学者可以先跳过，在熟悉基础后再回来学习。

---

## 6. 学完之后

完成本教程后，你已经掌握了构建 AI Agent 的基础能力。以下是可以探索的进阶方向：

| 方向 | 简介 |
|------|------|
| **多 Agent 协作** | 多个 Agent 分工合作完成复杂任务 |
| **长期记忆** | 使用向量数据库存储对话历史，实现"记得住"的 Agent |
| **RAG 集成** | 检索增强生成，让 Agent 基于文档回答问题 |
| **MCP 协议** | Model Context Protocol，标准化的工具调用协议 |
| **生产环境部署** | 速率限制、成本控制、日志监控、错误告警 |

---

## 一句话口诀

> **终局定方向，流程搭骨架，单点打通关，类比挂认知。**

- **终局**：构建能自主完成任务的 AI Agent
- **流程**：初始化 → 发请求 → 执行工具 → 结果回传 → 循环
- **单点**：天气查询 Agent，50 行代码跑通全流程
- **类比**：Tool 就像给 Claude 装的"App"，Agent Loop 就像"自动驾驶模式"
